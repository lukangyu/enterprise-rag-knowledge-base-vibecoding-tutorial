<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.graphrag.system.mapper.AuditLogMapper">
    
    <select id="selectPageByQuery" resultType="com.graphrag.system.domain.entity.AuditLog">
        SELECT * FROM sys_audit_log
        <where>
            deleted = 0
            <if test="query.userId != null and query.userId != ''">
                AND user_id = #{query.userId}
            </if>
            <if test="query.username != null and query.username != ''">
                AND username LIKE CONCAT('%', #{query.username}, '%')
            </if>
            <if test="query.action != null and query.action != ''">
                AND action = #{query.action}
            </if>
            <if test="query.resourceType != null and query.resourceType != ''">
                AND resource_type = #{query.resourceType}
            </if>
            <if test="query.startTime != null">
                AND created_at >= #{query.startTime}
            </if>
            <if test="query.endTime != null">
                AND created_at &lt;= #{query.endTime}
            </if>
        </where>
        ORDER BY created_at DESC
    </select>
    
    <select id="selectByUserId" resultType="com.graphrag.system.domain.entity.AuditLog">
        SELECT * FROM sys_audit_log
        WHERE deleted = 0 AND user_id = #{userId}
        ORDER BY created_at DESC
        LIMIT #{limit}
    </select>
    
    <select id="countByAction" resultType="java.lang.Long">
        SELECT COUNT(*) FROM sys_audit_log
        WHERE deleted = 0
        <if test="action != null and action != ''">
            AND action = #{action}
        </if>
    </select>
    
</mapper>
